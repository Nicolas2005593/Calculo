<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dominio, Rango y As√≠ntotas en [-20, 20]</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.5.0/math.min.js"></script>
  <style>
    body {margin:0;font-family:sans-serif;display:flex;height:100vh}
    .panel {
      flex:1;
      padding:20px;
      background:#f5f5f5;
    }
    h1 {
      font-size:1.3rem;
      margin-bottom:10px;
    }
    input, button {
      width:100%;
      font-size:1rem;
      padding:8px;
      margin-bottom:12px;
    }
    button {
      background:#1976d2;
      color:#fff;
      border:none;
      border-radius:4px;
      cursor:pointer;
    }
    button:hover {
      background:#145ca3;
    }
    #resultados {
      background:#fff;
      padding:12px;
      border-radius:6px;
      border:1px solid #ddd;
      margin-bottom:20px;
    }
    canvas {
      width:100%;
      height:300px;
      background:#fff;
      border:1px solid #ccc;
      border-radius:6px;
    }
    .chat-container {
      flex:0 0 300px;
      background:#fff;
      border-left:2px solid #ddd;
      display:flex;
      flex-direction:column;
    }
    .chat-header {
      background:#1976d2;
      color:#fff;
      text-align:center;
      padding:10px;
      font-weight:bold;
    }
    .chat-body {
      flex:1;
      overflow:auto;
      padding:10px;
    }
    .msg {
      margin-bottom:12px;
      line-height:1.4;
    }
    .user span {
      background:#cce5ff;
      padding:8px 12px;
      border-radius:10px 10px 0 10px;
      display:inline-block;
      float:right;
    }
    .bot span {
      background:#eee;
      padding:8px 12px;
      border-radius:10px 10px 10px 0;
      display:inline-block;
    }
  </style>
</head>
<body>

<div class="panel">
  <h1>‚úèÔ∏è Ingresa f(x) (solo se analizar√° entre -20 y 20)</h1>
  <input id="funcion" placeholder="Ej: x^2 - 4, 1/(x-2), sqrt(x)">
  <button onclick="resolver()">Resolver y graficar</button>
  <div id="resultados"></div>
  <canvas id="grafico"></canvas>
</div>

<div class="chat-container">
  <div class="chat-header">ü§ñ Bot Matem√°tico</div>
  <div id="chat" class="chat-body"></div>
</div>

<script>
let chart;
const chat = document.getElementById('chat');

function addMsg(sender, text){
  const div = document.createElement('div');
  div.className = 'msg ' + sender;
  div.innerHTML = `<span>${text}</span>`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function speak(text){
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'es-ES';
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

// Intervalo de an√°lisis
const X_MIN = -20;
const X_MAX = 20;

function resolver(){
  const expr = document.getElementById('funcion').value.trim();
  if (!expr) {
    alert("Escribe una funci√≥n v√°lida.");
    return;
  }

  addMsg('user', expr);
  let f;
  try {
    f = math.compile(expr);
  } catch {
    alert("La funci√≥n no se pudo interpretar.");
    return;
  }

  // Calcular dominio y rango aproximado
  const dominio = [];
  const valores = [];
  for (let x = X_MIN; x <= X_MAX; x += 0.2) {
    try {
      const y = f.evaluate({ x });
      if (typeof y === 'number' && isFinite(y)) {
        dominio.push(x);
        valores.push(y);
      }
    } catch {}
  }

  const rangoMin = Math.min(...valores);
  const rangoMax = Math.max(...valores);

  // Buscar as√≠ntotas verticales en [-20, 20]
  const asintotasV = [];
  for (let x = X_MIN; x <= X_MAX; x += 0.1) {
    let y1, y2;
    try { y1 = f.evaluate({ x: x - 0.01 }); } catch {}
    try { y2 = f.evaluate({ x: x + 0.01 }); } catch {}
    if (y1 !== undefined && y2 !== undefined && Math.abs(y1 - y2) > 50) {
      asintotasV.push(Number(x.toFixed(2)));
    }
  }

  // As√≠ntota horizontal
  let asintotaH = null;
  try {
    const yInf = f.evaluate({ x: 1e6 });
    const yNegInf = f.evaluate({ x: -1e6 });
    if (Math.abs(yInf - yNegInf) < 1) {
      asintotaH = yInf.toFixed(2);
    }
  } catch {}

  // Mostrar resultados
  const resHTML = `
    <strong>üìå Dominio (en [-20, 20]):</strong><br>
    ${dominio.length ? `De x = ${X_MIN} hasta x = ${X_MAX} (con huecos en as√≠ntotas)` : 'No definido'}<br>
    <strong>üìå Rango aprox.:</strong> y ‚àà [${rangoMin.toFixed(2)}, ${rangoMax.toFixed(2)}]<br>
    <strong>üìå As√≠ntotas verticales (en [-20, 20]):</strong> ${asintotasV.length ? asintotasV.join(', ') : 'ninguna'}<br>
    <strong>üìå As√≠ntota horizontal:</strong> ${asintotaH !== null ? 'y = ' + asintotaH : 'ninguna'}
  `;
  document.getElementById('resultados').innerHTML = resHTML;

  // Bot habla
  const botText = `Dominio entre menos 20 y 20. Rango entre ${rangoMin.toFixed(2)} y ${rangoMax.toFixed(2)}. ` +
                  `As√≠ntotas verticales: ${asintotasV.length ? asintotasV.join(', ') : 'ninguna'}. ` +
                  `As√≠ntota horizontal: ${asintotaH ? 'y = ' + asintotaH : 'ninguna'}.`;
  addMsg('bot', botText);
  speak(botText);

  // Graficar
  const xs = [], ys = [];
  for (let x = X_MIN; x <= X_MAX; x += 0.2) {
    try {
      const y = f.evaluate({ x });
      xs.push(x.toFixed(2));
      ys.push(y);
    } catch {
      xs.push(x.toFixed(2));
      ys.push(null);
    }
  }

  if (chart) chart.destroy();
  chart = new Chart(document.getElementById('grafico'), {
    type: 'line',
    data: {
      labels: xs,
      datasets: [{
        label: `f(x) = ${expr}`,
        data: ys,
        fill: false,
        borderWidth: 2,
        spanGaps: false
      }]
    },
    options: {
      scales: {
        x: { title: { display: true, text: 'x' }},
        y: { title: { display: true, text: 'f(x)' }}
      }
    }
  });
}
</script>
</body>
</html>
