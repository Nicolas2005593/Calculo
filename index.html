<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ecuaciones (fracciones / x√∑n) + bot parlante</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body{margin:0;font-family:Arial,Helvetica,sans-serif;display:flex;height:100vh}
  .panel{flex:1;padding:22px;overflow:auto}
  h1{font-size:1.2rem;margin:0}
  input,button{font-size:1rem;padding:6px 8px;margin:10px 0;width:100%}
  button{background:#1976d2;color:#fff;border:none;border-radius:4px;cursor:pointer}
  button:hover{background:#145ca3}
  #resultados{background:#fff;border:1px solid #ddd;padding:12px;border-radius:6px}
  canvas{width:100%;background:#fff;border:1px solid #ddd;border-radius:6px;margin-top:20px}
  .chat-container{flex:0 0 300px;border-left:2px solid #ddd;background:#fff;display:flex;flex-direction:column}
  .chat-header{background:#1976d2;color:#fff;text-align:center;padding:10px;font-weight:bold}
  .chat-body{flex:1;overflow:auto;padding:10px}
  .msg{margin-bottom:12px;line-height:1.4}
  .user span{background:#cce5ff;padding:8px 12px;border-radius:10px 10px 0 10px;display:inline-block;float:right}
  .bot  span{background:#eee;padding:8px 12px;border-radius:10px 10px 10px 0;display:inline-block}
</style>
</head>
<body>

<div class="panel">
  <h1>Escribe tu ecuaci√≥n (hasta grado 2, con fracciones o x/ n)</h1>
  <input type="text" id="ecuacion" placeholder="Ej.: -x/2 + 3/4x^2 - 5/6">
  <button onclick="resolver()">Resolver y graficar</button>

  <div id="resultados"></div>
  <canvas id="grafico"></canvas>
</div>

<div class="chat-container">
  <div class="chat-header">ü§ñ Bot Matem√°tico</div>
  <div id="chat" class="chat-body"></div>
</div>

<script>
let chart;
const chatBody = document.getElementById('chat');

/* --- utilidades de chat & voz --- */
function addMsg(sender, text){
  const div = document.createElement('div');
  div.className = 'msg ' + sender;
  div.innerHTML = `<span>${text}</span>`;
  chatBody.appendChild(div);
  chatBody.scrollTop = chatBody.scrollHeight;
}
function speak(text){
  if (!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'es-ES';  speechSynthesis.cancel();  speechSynthesis.speak(u);
}

/* --- convierte string ‚Äúcoef‚Äù (entero, decimal o fracci√≥n) a n√∫mero --- */
function fracToDec(str){
  if (str === '' || str === '+') return 1;
  if (str === '-') return -1;
  if (str.includes('/')){
    const [n,d] = str.split('/').map(Number);
    return n / d;
  }
  return parseFloat(str);
}

/* --- PRE-PROCESA la ecuaci√≥n para admitir x/num o x^2/num --- */
function normalizarXdivNumero(s){
  /*   +x/3   -x/4     +x^2/5      -x^2/6   */
  return s.replace(/([+\-])x(\^2)?\/(\d*\.?\d+)/g, (_,sign,pow,den) => {
    const coef = (+sign + 0) === -1 ? -1/den : 1/den;         // ¬±1/den
    return (coef>=0?'+':'') + coef + 'x' + (pow || '');
  });
}

/* --- obtiene a, b, c --- */
function parseEcuacion(raw){
  let s = raw.toLowerCase().replace(/\s+/g,'');
  if (!s) return null;
  if (s[0] !== '+' && s[0] !== '-') s = '+' + s;              // fuerza signo inicial
  s = normalizarXdivNumero(s);                                 // x/num ‚Üí coef¬∑x
  const terminos = s.match(/[+\-][^+\-]+/g) || [];

  let a=0,b=0,c=0;
  terminos.forEach(t=>{
    if (t.includes('x^2')){
      const coef = t.replace('x^2','');
      a += fracToDec(coef);
    } else if (t.includes('x')){
      const coef = t.replace('x','');
      b += fracToDec(coef);
    } else {
      c += fracToDec(t);
    }
  });
  return {a,b,c};
}

function resolver(){
  const entrada = document.getElementById('ecuacion').value.trim();
  addMsg('user', entrada || '(vac√≠o)');

  const coef = parseEcuacion(entrada);
  if (!coef || (coef.a === 0 && coef.b === 0)){
    alert('La ecuaci√≥n debe contener x o x¬≤.');
    return;
  }
  const {a,b,c} = coef;

  /* --- resoluci√≥n --- */
  let sol='', rango='', dominio='Dominio: (-‚àû, ‚àû)';
  if (a === 0){                       // lineal
    const x = -c / b;
    sol   = `Soluci√≥n: x = ${x.toFixed(4)}`;
    rango = 'Rango: (-‚àû, ‚àû)';
  } else {                            // cuadr√°tica
    const D = b*b - 4*a*c;
    if (D > 0){
      const x1 = (-b + Math.sqrt(D)) / (2*a);
      const x2 = (-b - Math.sqrt(D)) / (2*a);
      sol = `Dos soluciones reales: x‚ÇÅ = ${x1.toFixed(4)}, x‚ÇÇ = ${x2.toFixed(4)}`;
    } else if (D === 0){
      const x = -b / (2*a);
      sol = `Una soluci√≥n real doble: x = ${x.toFixed(4)}`;
    } else {
      const re = (-b / (2*a)).toFixed(4);
      const im = (Math.sqrt(-D) / (2*a)).toFixed(4);
      sol = `Soluciones complejas: x = ${re} ¬± ${im}i`;
    }
    const yv = -D / (4*a);
    rango = a > 0 ? `Rango: [${yv.toFixed(4)}, ‚àû)` : `Rango: (-‚àû, ${yv.toFixed(4)}]`;
  }

  document.getElementById('resultados').innerHTML =
    `<strong>${sol}</strong><br>${dominio}<br>${rango}`;

  const botText = `${sol}. ${dominio}. ${rango}.`;
  addMsg('bot', botText);  speak(botText);

  /* --- gr√°fico --- */
  const xs = [], ys = [];
  for (let x = -20; x <= 20; x += 0.2){
    ys.push(a*x*x + b*x + c);
    xs.push(x.toFixed(2));
  }
  if (chart) chart.destroy();
  chart = new Chart(document.getElementById('grafico'),{
    type:'line',
    data:{labels:xs,datasets:[{label:'f(x)',data:ys,fill:false,tension:0.12,borderWidth:2}]},
    options:{scales:{x:{title:{display:true,text:'x'}},y:{title:{display:true,text:'f(x)'}}}}
  });
}
</script>
</body>
</html>
